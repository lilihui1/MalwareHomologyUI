<template>
	 <div class="login-box">
	        <!-- 通过:rules="loginFormRules"来绑定输入内容的校验规则 -->
	        <el-form :rules="loginFormRules" ref="loginForm" :model="loginForm" label-position="right" label-width="auto" show-message>
	            <span class="login-title">欢迎使用恶意程序同源性分析系统</span>
	            <div style="margin-top: 5px"></div>
	            <el-form-item label="用户名" prop="loginName" class="lableColor">
	                <el-col :span="22">
	                    <el-input type="text" v-model="loginForm.loginName"></el-input>
	                </el-col>
	            </el-form-item>
	            <el-form-item label="密码" prop="loginPassword" class="lableColor">
	                <el-col :span="22">
	                    <el-input type="password" v-model="loginForm.loginPassword"></el-input>
	                </el-col>
	            </el-form-item>
	            <el-form-item class="login-button">
	                <el-button type="primary" @click="loginSubmit('loginForm',loginForm)">登录</el-button>
	                <el-button type="primary" @click="onRegit('loginForm')">注册</el-button>
	            </el-form-item>
				<el-form-item >
					<el-button class="forgetPassword" @click="forgetPassword()" type="text" size="small">忘记密码？点击找回</el-button>
				</el-form-item>
	        </el-form>
			
	    </div>
</template>

<script>
	 export default {
	        name: "login",
	        data() {
	            return {
	                loginForm: {
	                    loginName: '',
	                    loginPassword: ''
	                },
	                // 表单验证，需要在 el-form-item 元素中增加 prop 属性
	                loginFormRules: {
	                    loginName: [
	                        {required: true, message: '账号不可为空', trigger: 'blur'}
	                    ],
	                    loginPassword: [
	                        {required: true, message: '密码不可为空', trigger: 'blur'}
	                    ]
	                }
	            }
	        },
	        methods: {
	            loginSubmit(formName,loginForm) {
					const _this = this;
	                // 为表单绑定验证功能
	                this.$refs[formName].validate((valid) => {
	                    if (valid) {
	                        // 使用 vue-router 路由到指定页面，该方式称之为编程式导航
							//查询后台成功才跳转
							axios.post('/auth/login',{
								username:loginForm.loginName,
								password:loginForm.loginPassword,
								rememberMe:0
							}).then(function(res){
								if(res.data.successful){
									//成功
									localStorage.setItem("userId",res.data.userId)
									localStorage.setItem("token",res.data.token)
									_this.$message({
									          message: '登陆成功',
									          type: 'success'
									        });
									//console.log(res.data.data.userId)
									
									_this.$router.push({
										path:"/showPage",
										name:"showPage",
										params:{userId:res.data.userId}
									})
								}else{
									//失败
									//alert(res.data.errorMessage)
									_this.$message.error(res.data.errorMessage);
								}
								console.log(res);
							}).catch(function(err){
								console.log(err);
							});
	                    } else {
							console.log('error submit!!');
	                        return false;
	                    }
	                });
	            },
				forgetPassword(){
					this.$router.replace("/forgetPassword");
				},
				onRegit(formName){
					this.$router.replace("/register");
				}
	        },
			created(){
				
			}
	    }
</script>

<style>
	.login-box {
	        border: 1px solid #DCDFE6;
	        width: 550px;
	        margin: 180px auto;
	        padding: 35px 35px 15px 35px;
	        border-radius: 5px;
	        -webkit-border-radius: 5px;
	        -moz-border-radius: 5px;
	        box-shadow: 0 0 25px paleturquoise;
	    }
	    .login-title {
	        text-align: center;
	        margin: 0 auto 40px auto;
	        color: #00aaff;
	        font-size: 30px;
	        font-weight: bold;
	    }
		.forgetPassword{
			/* position:absolute;
			right:20px;
			bottom:0px;
			width:60px; */
			float: right;
		}
</style>
