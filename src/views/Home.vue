<template>
	<div class="navigation">
		<el-input v-model="formdata.path" placeholder="请输入文件路径"></el-input>
		<div class="upload">
			<el-upload
			  class="upload-demo"
			  ref="upload"
			  :file-list="fileList"
			  drag
			  :data="formdata"
			  :limit="1"
			  :auto-upload="false"
			  action="http://localhost:8081/malware/tasks/create/submit"
			  :before-upload="beforeUploadFile"
			  :on-progress="processFile"
			  :on-change="changeFile"
			  :on-success="handleSuccess"
			  :on-error="handleError"
			  multiple>
			  <i class="el-icon-upload"></i>
			  <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
			  
			  <!-- <div class="el-upload__tip" slot="tip"></div> -->
			</el-upload>
			<el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button>
		</div>
	</div>
</template>

<script>
	export default {
		data(){
			return{
				userId:0,
				limitNum:1,
				fileList:[],
				formdata:{userId:1,path:""}
			}
		},
		methods: {
			submitUpload(){
				this.$refs.upload.submit();
			},
			handleSuccess(res, file, fileList){
				console.log(res)
				if(res.successful){
					alert("上传成功!")
					//刷新当前页面
					this.$router.go(0)
				}
			},
			// 文件上传失败时的钩子
			handleError(err, file, fileList) {
				console.log(res);
			    // this.$notify.error({
			    // title: '错误',
			    // message: `文件上传失败`
			    // });
			},
			beforeUploadFile(file){
				console.log("上传文件之前",file)
			},
			changeFile(file, fileList){
				console.log("改变文件",file)
				//console.log(fileList)
			},
			processFile(event, file, fileList){
				console.log("处理文件",file)
				//console.log(event)
			}
		},
		created(){
			 //this.userId = this.$route.params.userId;
			 this.userId=localStorage.getItem("userId");
			 //this.formdata.userId = this.$route.params.userId;
			 this.formdata.userId = localStorage.getItem("userId");
		}
	}
</script>

<style scoped>
	.el-row {
	    margin-bottom: 20px;
	    &:last-child {
	      margin-bottom: 0;
	    }
	  }
	  .el-col {
	    border-radius: 4px;
	  }
	  .bg-purple-dark {
	    background: #99a9bf;
	  }
	  .bg-purple {
	    background: #d3dce6;
	  }
	  .bg-purple-light {
	    background: #e5e9f2;
	  }
	  .grid-content {
	    border-radius: 4px;
	    min-height: 36px;
	  }
	  .row-bg {
	    padding: 10px 0;
	    background-color: #f9fafc;
	  }
</style>
