<template>
	<div>
		<el-container>
		  <el-aside width="200px">
			  <div>
			    <el-avatar :size="100"> user </el-avatar>
			  </div>
			  <el-button @click="editMessage" type="primary" round>编辑资料</el-button>
			  <el-button @click="logOut" type="info" round>退出登陆</el-button>
		  </el-aside>
		  <el-container>
		    <el-header><h1>系统用户列表</h1></el-header>
		    <el-main>
				<el-table v-show="admin"
				    :data="tableData"
				    stripe
					border
				    style="width: 100%">
				    <el-table-column
				      prop="name"
				      label="用户名"
				      width="480">
				    </el-table-column>
				    <el-table-column
				      label="操作"
				      width="500">
				      <template slot-scope="scope">
				          <el-button @click="manageUser(scope.row)" type="text" size="small">管理</el-button>
				      </template>
				    </el-table-column>
				  </el-table>
				  <h2 v-show="!admin">{{errorMessage}}</h2>
			</el-main>
		  </el-container>
		</el-container>
	</div>
</template>

<script>
	export default{
		data(){
			return{
				tableData:[],
				errorMessage:"你不是系统管理员无权查看",
				admin:false,
				normalUser:true
			}
		},
		methods: {
			logOut() {
				this.$router.push({
					path:"/",
					name:"login",
					params:{}
				})
			},
			editMessage(){
				this.$router.push({
					path:"/userInfo",
					name:"userInfo",
					params:{userId:localStorage.getItem("userId")}
				})
			},
			manageUser(row){
				this.$router.push({
					path:"/userInfo",
					name:"userInfo",
					params:{userId:row.userId}
				})
			}
		},
		created(){
			const _this = this
			axios.post('http://localhost:8081/malware/getAllUser',{
								userId:localStorage.getItem("userId")
					}).then(function(resp){
			    //console.log(resp)
				if(resp.data.errorCode=="1"){
					//是管理员
					_this.admin=true
					_this.tableData=resp.data.data
				}
				else{
					_this.errorMessage=resp.data.errorMessage
					_this.admin=false
					_this.normalUser = true
				}
			}).catch(function(err){
				console.log(err);
			});
		}
	}
</script>

<style scoped>
	.el-header, .el-footer {
	    background-color: #B3C0D1;
	    color: #333;
	    text-align: center;
	    line-height: 60px;
	  }
	  
	  .el-aside {
	    background-color: #D3DCE6;
	    color: #333;
	    text-align: center;
	    line-height: 200px;
	  }
	  
	  .el-main {
	    background-color: #E9EEF3;
	    color: #333;
	    text-align: center;
	    line-height: 160px;
	  }
	  
	  body > .el-container {
	    margin-bottom: 40px;
	  }
	  
	  .el-container:nth-child(5) .el-aside,
	  .el-container:nth-child(6) .el-aside {
	    line-height: 260px;
	  }
	  
	  .el-container:nth-child(7) .el-aside {
	    line-height: 320px;
	  }
</style>
