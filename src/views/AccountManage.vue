<template>
	<div>
		<el-container>
		  <el-aside width="150px">
			  <div class="div-aside">
				  <el-row class="image">
				     <el-avatar :size="80" >user</el-avatar>
				  </el-row>
				  <el-row class="button0">
				     <el-button @click="uploadHistory" type="primary" round>上传记录</el-button>
				  </el-row>
				  <el-row class="button1">
				     <el-button @click="editMessage" type="primary" round>编辑资料</el-button>
				  </el-row>
				  <el-row class="button2">
				     <el-button @click="logOut" type="info" round>退出登陆</el-button>
				  </el-row>
				  
			  </div>
		  </el-aside>
		  <el-container>
		    <el-header>
				<div class="title">
					<h3>系统用户列表</h3>
				</div>
			</el-header>
		    <el-main>
				<el-table v-show="admin"
				    :data="tableData"
				    stripe
					border
				    style="width: 100%">
				    <el-table-column
				      prop="name"
				      label="用户名"
				      width="480">
				    </el-table-column>
				    <el-table-column
				      label="操作"
				      width="500">
				      <template slot-scope="scope">
				          <el-button @click="manageUser(scope.row)" type="text" size="small">管理</el-button>
				      </template>
				    </el-table-column>
				  </el-table>
				  <h2 v-show="!admin">{{errorMessage}}</h2>
			</el-main>
		  </el-container>
		</el-container>
	</div>
</template>

<script>
	import moment from 'moment'
	export default{
		inject:['reload'],
		data(){
			return{
				tableData:[],
				errorMessage:"你不是系统管理员无权查看",
				admin:false,
				normalUser:true
			}
		},
		methods: {
			uploadHistory(){
				this.$router.replace("/showPage");
			},
			logOut() {
				this.$confirm('确认退出吗?', '提示', {
				          confirmButtonText: '确定',
				          cancelButtonText: '取消',
				          type: 'warning'
				        }).then(() => {
						  clearInterval(localStorage.getItem("timer"));
				          localStorage.removeItem("userId")
				          localStorage.removeItem("token")
				          this.$router.push({
				          	path:"/",
				          	name:"login",
				          	params:{}
				          })
						  //this.$router.go(0)
						  this.reload()
				        }).catch(() => {
				               
				        });
				
			},
			editMessage(){
				this.$router.push({
					path:"/userInfo",
					name:"userInfo",
					params:{userId:localStorage.getItem("userId")}
				})
			},
			manageUser(row){
				this.$router.push({
					path:"/userInfo",
					name:"userInfo",
					params:{userId:row.userId}
				})
			}
		},
		created(){
			const _this = this
			axios.post('http://localhost:8081/malware/getAllUser',{
								userId:localStorage.getItem("userId")
					}).then(function(resp){
			    //console.log(resp)
				if(resp.data.errorCode=="1"){
					//是管理员
					_this.admin=true
					_this.tableData=resp.data.data
				}
				else{
					_this.errorMessage=resp.data.errorMessage
					_this.admin=false
					_this.normalUser = true
				}
			}).catch(function(err){
				console.log(err);
			});
			
		}
	}
</script>

<style scoped>
	.el-header {
	    background-color: #B3C0D1;
	    color: #333;
	    text-align: center;
	    line-height: 30px;
		padding:0px;
	  }
	  
	  .el-aside {
	    background-color: #636365;
	    color: #333;
	    text-align: center;
	    line-height: 150px;
	  }
	  
	  .el-main {
	    background-color: #E9EEF3;
	    color: #333;
	    text-align: center;
	    line-height: 50px;
		padding:0px;
	  }
	  
	  body > .el-container {
	    margin-bottom: 40px;
	  }
	  
	  .el-container:nth-child(5) .el-aside,
	  .el-container:nth-child(6) .el-aside {
	    line-height: 260px;
	  }
	  
	  .el-container:nth-child(7) .el-aside {
	    line-height: 320px;
	  }
	  .div-aside{
		  position: relative;
		  margin: auto;
	  }
	  .image{
		position: absolute;
		top: 50px;
		width: 100%;
		z-index: 1;
	  }
	  .button0{
	  	   position: absolute;
	  	   top: 150px;
	  	   width: 100%;
	  }
	  .button1{
		  position: absolute;
		  top: 250px;
		  width: 100%;
	  }
	  .button2{
	  	position: absolute;
	  	top: 350px;
		width: 100%;
	  }
	  .title{
		  text-align:center;
	  }
</style>
