<template>
	 <div class="login-box">
	        <!-- 通过:rules="loginFormRules"来绑定输入内容的校验规则 -->
	        <el-form :rules="loginFormRules" ref="registerForm" :model="registerForm" label-position="right" label-width="auto" show-message>
	            <span class="login-title">欢迎使用恶意性程序同源性分析系统</span>
	            <div style="margin-top: 5px"></div>
	            <el-form-item label="用户名" prop="loginName" class="lableColor">
	                <el-col :span="22">
	                    <el-input type="text" v-model="registerForm.loginName"></el-input>
	                </el-col>
	            </el-form-item>
	            <el-form-item label="密码" prop="loginPassword" class="lableColor">
	                <el-col :span="22">
	                    <el-input type="password" v-model="registerForm.loginPassword"></el-input>
	                </el-col>
	            </el-form-item>
				<el-form-item label="确认密码" prop="confirmPassword" class="lableColor">
				    <el-col :span="22">
				        <el-input type="password" v-model="registerForm.confirmPassword"></el-input>
				    </el-col>
				</el-form-item>
				<el-form-item label="邮箱" prop="email" class="lableColor">
				    <el-col :span="22">
				        <el-input type="text" v-model="registerForm.email"></el-input>
				    </el-col>
				</el-form-item>
	            <el-form-item>
	                <el-button type="primary" @click="registerSubmit('registerForm',registerForm)">注册</el-button>
					<el-button type="primary" @click="back">返回登陆</el-button>
	            </el-form-item>
	        </el-form>
	    </div>
</template>

<script>
	 export default {
	        name: "login",
	        data() {
				var validatePass = (rule, value, callback) => {
				        if (value === '') {
				          callback(new Error('请再次输入密码'));
				        } else if (value !== this.registerForm.loginPassword) {
				          callback(new Error('两次输入密码不一致!'));
				        } else {
				          callback();
				        }
				      };
			    var emailValidate = (rule, value, callback) => {
				        if (value === '') {
				          // callback(new Error('请再次输入密码'));
				        }
						else {
							// var verify = /^\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/;
							var reg=/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
							if (!reg.test(value)) {
							    // this.message = '邮箱格式错误, 请重新输入'
								callback(new Error('邮箱格式错误'));
							}
							// else{
							// 	callback();
							// }
							
				        }
						callback();
				      };
	            return {
	                registerForm: {
	                    loginName: '',
	                    loginPassword: '',
						confirmPassword:'',
						email:''
	                },
	                // 表单验证，需要在 el-form-item 元素中增加 prop 属性
	                loginFormRules: {
	                    loginName: [
	                        {required: true, message: '账号不可为空', trigger: 'blur'}
	                    ],
	                    loginPassword: [
	                        {required: true, message: '密码不可为空', trigger: 'blur'}
	                    ],
						email: [
							{required: false,validator: emailValidate}
						],
						confirmPassword: [
						    {validator: validatePass, trigger: 'blur'}
						]
	                }
	            }
	        },
	        methods: {
				back(){
					this.$router.replace("/");
				},
	            registerSubmit(formName,registerForm) {
					const _this = this;
	                // 为表单绑定验证功能
	                this.$refs[formName].validate((valid) => {
	                    if (valid) {
	                        // 使用 vue-router 路由到指定页面，该方式称之为编程式导航
							// TODO 在这调用后台插入一次数据库
							axios.post('/auth/register',{
								name:registerForm.loginName,
								password:registerForm.loginPassword,
								email:registerForm.email
							}).then(function(res){
								if(res.data.successful){
									//成功
									//alert("注册成功")
									_this.$message({
									          message: '注册成功',
									          type: 'success'
									        });
									_this.$router.replace("/");
								}else{
									//失败
									//alert(res.data.errorMessage)
									_this.$message.error(res.data.errorMessage);
								}
								console.log(res);
							}).catch(function(err){
								console.log(err);
							});
	                    } else {
	                        return false;
	                    }
	                });
	            }
	        }
	    }
</script>

<style scoped>
	.login-box {
	        border: 1px solid #DCDFE6;
	        width: 550px;
	        margin: 180px auto;
	        padding: 35px 35px 15px 35px;
	        border-radius: 5px;
	        -webkit-border-radius: 5px;
	        -moz-border-radius: 5px;
	        box-shadow: 0 0 25px paleturquoise;
	    }
	    .login-title {
	        text-align: center;
	        margin: 0 auto 40px auto;
	        color: #00aaff;
	        font-size: 30px;
	        font-weight: bold;
	    }
</style>
